# ADR: テストコードの配置場所

## 実装日

2025 年 9 月 7 日

## 背景・課題

### 問題

- テストコードの配置場所を統一する必要がある
- 本番コードとテストコードの分離を明確にする必要がある
- 開発効率とメンテナンス性を考慮した配置方法を決定する必要がある

### 要件

- 本番コードとテストコードの明確な分離
- テストコードの見つけやすさ
- ファイル数の増加に対する対応
- 開発効率の向上

## 決定事項

### テストコード配置場所

**`tests/`ディレクトリを採用**

- `src/`と同列に`tests/`ディレクトリを作成
- `src/`内と同様の階層構造でテストコードを配置
- 例：`src/domain/task.ts` → `tests/domain/task.spec.ts`

### ディレクトリ構造

```
project-root/
├── src/
│   ├── domain/
│   │   ├── task.ts
│   │   └── task-domain-service.ts
│   ├── presentation/
│   │   └── components/
│   │       └── task-list.tsx
│   └── infrastructure/
│       └── local-storage.ts
├── tests/
│   ├── domain/
│   │   ├── task.spec.ts
│   │   └── task-domain-service.spec.ts
│   ├── presentation/
│   │   └── components/
│   │       └── task-list.spec.tsx
│   └── infrastructure/
│       └── local-storage.spec.ts
└── tsconfig.test.json
```

### 命名規則

- テストファイルは`.spec.ts`または`.spec.tsx`の拡張子を使用
- 本番コードと同じファイル名に`.spec`を追加

## 結果・影響

### メリット

- 本番コードとテストコードの明確な分離
- `src/`内のファイル数増加を回避
- 階層構造が本番コードと一致するため、テストファイルの場所が分かりやすい
- ビルド時にテストコードを簡単に除外可能
- IDE でのファイル検索が効率的

### デメリット

- 本番コードとテストコードが物理的に離れる
- テストファイルの作成時にディレクトリ構造を意識する必要がある

### リスク

- テストファイルの場所を忘れる可能性
- ディレクトリ構造の同期が取れなくなる可能性

## 代替案

### 代替案 1: src 内の各ディレクトリに本番コードと同じ位置にテストコードを配置

- **メリット**:
  - 本番コードとテストコードが近い位置にある
  - テストファイルの場所が分かりやすい
- **デメリット**:
  - 本番コード、テストコードが増えてくると、src 内に配置するとファイル数が多くなる
  - ビルド設定でテストファイルを除外する必要がある

### 代替案 2: src 内の各ディレクトリに`__test__`ディレクトリを作成してテストコードを配置

- **メリット**:
  - 本番コードと近い位置にテストコードがある
  - テストコードが明確に分離される
- **デメリット**:
  - `__test__`ディレクトリを都度作成するのは面倒
  - ディレクトリ構造が複雑になる

## 関連資料

- [Jest Testing Framework](https://jestjs.io/)
- [Vitest Testing Framework](https://vitest.dev/)
- [Testing Library](https://testing-library.com/)
